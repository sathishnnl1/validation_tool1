<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Data Comparator</title>
    <link rel="stylesheet" href="assets/style.css">
</head>
<body>

<div class="app-layout">
    
    <aside class="sidebar">
        <div class="sidebar-header">
            <h3>Comparator Tool</h3>
            <div class="mode-toggle">
                <label class="mode-label">SELECT MODE:</label>
                <select id="appMode" onchange="toggleAppMode()">
                    <option value="creator">1. Creator (Make Order)</option>
                    <option value="validator">2. Validator (Check Sub)</option>
                </select>
            </div>
        </div>

        <div class="vertical-nav">
            <div class="v-step active" id="navStep1" onclick="jumpToStep(1)">
                <span class="v-num">1</span> <span class="v-text">Input Data</span>
            </div>
            <div class="v-step" id="navStep2" onclick="jumpToStep(2)">
                <span class="v-num">2</span> <span class="v-text">Clean Data</span>
            </div>
            <div class="v-step" id="navStep3" onclick="jumpToStep(3)">
                <span class="v-num">3</span> <span class="v-text">Map Columns</span>
            </div>
            <div class="v-step" id="navStep4" onclick="jumpToStep(4)">
                <span class="v-num">4</span> <span class="v-text">Results</span>
            </div>
        </div>

        <div class="sidebar-footer">
            <button onclick="cleanAllSets()" class="btn-sidebar btn-secondary">
                ‚ú® Clean Data
            </button>
            <button onclick="runAllComparisons()" class="btn-sidebar btn-run-all">
                ‚ñ∂ Run Analysis
            </button>
        </div>
    </aside>

    <div class="main-wrapper">
        
        <header class="top-bar">
            <div class="order-info-group">
                <div class="input-wrapper">
                    <span class="input-label">Order #</span>
                    <input type="text" id="orderInput" placeholder="Type Order..." class="top-input">
                </div>
                
                <div class="input-wrapper" id="creatorPoWrapper">
                    <span class="input-label">PO # (Source)</span>
                    <input type="text" id="poInput" placeholder="Type PO..." class="top-input">
                </div>

                <div class="input-wrapper" id="validatorPoWrapper" style="display:none;">
                    <span class="input-label">Verify PO #</span>
                    <input type="text" id="validatorPoVerify" placeholder="Verify PO..." class="top-input" style="border-color:#a855f7;">
                </div>
            </div>

            <div id="tabsWrapper" class="tabs-container">
                <div class="tab-item" id="tabOverview" onclick="showOverview()">üìä Overview</div>
                <div id="projectTabs" class="project-tabs"></div>
            </div>

            <div class="top-actions-right">
                <div id="creatorActions">
                    <input type="number" id="addSetQty" value="1" min="1" max="50" class="qty-input" title="Number of sets">
                    <button id="btnAddSets" onclick="addSetsFromInput()" class="btn-top-add">+ Add Set</button>
                    <button onclick="saveOrderToCloud()" class="btn-top-save">‚òÅÔ∏è Lock & Save</button>
                </div>
                <div id="validatorActions" style="display:none;">
                    <button onclick="fetchOrderFromCloud()" class="btn-top-fetch">üîç Find Order</button>
                </div>
            </div>
        </header>

        <main class="content-area">
            
            <div class="wizard-stepper">
                <div class="w-step active" onclick="jumpToStep(1)"><div class="w-circle">1</div> <span>Input</span></div>
                <div class="w-step" onclick="jumpToStep(2)"><div class="w-circle">2</div> <span>Clean</span></div>
                <div class="w-step" onclick="jumpToStep(3)"><div class="w-circle">3</div> <span>Map</span></div>
                <div class="w-step" onclick="jumpToStep(4)"><div class="w-circle">4</div> <span>Result</span></div>
            </div>

            <div id="overviewSection" class="page-section fade-in">
                <div class="section-header"><h2>Overall Result</h2></div>
                <div id="overviewStats" class="dashboard-stats"></div>
                <div class="table-box" style="margin-top:20px;">
                    <table class="clean-table" id="overviewTable">
                        <thead><tr><th>Set Name</th><th>Status</th><th>Rows</th><th>Matches</th><th>Mismatches</th><th>Action</th></tr></thead>
                        <tbody id="overviewBody"></tbody>
                    </table>
                </div>
            </div>

            <div id="step1" class="page-section fade-in" style="display:none;">
                <div class="section-header">
                    <h2 id="step1Title">Step 1: Paste Data</h2>
                    <div class="header-actions">
                        <button onclick="clearCurrentProject()" class="btn-ghost">Clear</button>
                        <button onclick="goToPreview()" class="btn-primary">Next: Clean ‚Üí</button>
                    </div>
                </div>

                <div class="input-grid-container">
                    <div class="tables-row">
                        
                        <div class="input-card" id="cardSource">
                            <div class="card-head blue-head">
                                <label id="lblSource">Table 1 ‚Äî Source</label>
                                <select id="headerModeA" class="mini-select"><option value="1row">1 Header Row</option><option value="2rows">2 Header Rows</option></select>
                            </div>
                            <textarea id="tableA" placeholder="Paste Source Data..."></textarea>
                            <div id="lockedOverlay" style="display:none; position:absolute; top:45px; left:0; right:0; bottom:0; background:rgba(240,245,255,0.7); display:flex; align-items:center; justify-content:center; backdrop-filter:blur(1px);">
                                <div style="background:white; padding:10px 20px; border-radius:20px; box-shadow:0 2px 10px rgba(0,0,0,0.1); font-weight:bold; color:#3b82f6;">üîí Locked from Cloud</div>
                            </div>
                        </div>

                        <div class="input-card">
                            <div class="card-head green-head">
                                <label id="lblTarget">Table 2 ‚Äî Extracted</label>
                                <select id="headerModeB" class="mini-select"><option value="1row">1 Header Row</option><option value="2rows">2 Header Rows</option></select>
                            </div>
                            <textarea id="tableB" placeholder="Paste Extracted Data..."></textarea>
                        </div>
                    </div>

                    <button onclick="toggleMatrix()" class="btn-secondary" id="btnToggleMatrix" style="width:100%; margin-top:20px;">+ Show Matrix Rules</button>
                    <div id="matrixSection" style="display:none;">
                        <div class="matrix-split-view">
                            <div class="matrix-source">
                                <label style="font-size:12px; font-weight:bold; color:#64748b; margin-bottom:5px;">Paste Rules</label>
                                <textarea id="matrixRawInput" placeholder='Example: "ADAPTIVE" NO' oninput="autoParseMatrix()"></textarea>
                            </div>
                            <div class="matrix-divider">‚ûú</div>
                            <div class="matrix-editor"><div id="matrixList" class="matrix-list"></div></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="step2" class="page-section fade-in" style="display:none;">
                <div class="section-header">
                    <h2>Step 2: Clean Data</h2>
                    <div class="header-actions"><button onclick="jumpToStep(1)" class="btn-secondary">‚Üê Back</button><button onclick="goToMapping()" class="btn-primary">Next: Map ‚Üí</button></div>
                </div>
                <div class="tables-grid">
                    <div class="table-box">
                        <div class="box-header blue-bg">Source (<span id="countA">0</span> rows)</div>
                        <div class="scroll-wrap"><table id="previewTableA" class="clean-table"></table></div>
                    </div>
                    <div class="table-box">
                        <div class="box-header green-bg">Extracted (<span id="countB">0</span> rows)</div>
                        <div class="scroll-wrap"><table id="previewTableB" class="clean-table"></table></div>
                    </div>
                </div>
            </div>

            <div id="step3" class="page-section fade-in" style="display:none;">
                <div class="section-header">
                    <div style="display:flex; flex-direction:column;">
                        <h2>Step 3: Map Columns</h2>
                        <span id="unmappedList" class="unmapped-badge">Checking...</span>
                    </div>
                    <div class="header-actions"><button onclick="jumpToStep(2)" class="btn-secondary">‚Üê Back</button><button onclick="generateResults()" class="btn-success">Run Analysis ‚Üí</button></div>
                </div>
                <div class="card full-height"><div class="scroll-wrap"><table class="mapping-table"><tbody id="mappingBody"></tbody></table></div></div>
            </div>

            <div id="step4" class="page-section fade-in" style="display:none;">
                <div class="section-header"><h2>Step 4: Results</h2></div>
                
                <div id="validatorResultBanner" style="display:none; margin-bottom:20px;"></div>

                <div id="globalStats" class="dashboard-stats"></div>
                <div id="summaryCards" class="cards-grid"></div>
                <div class="tables-grid">
                    <div class="table-box"><table id="renderTableA"></table></div>
                    <div class="table-box"><table id="renderTableB"></table></div>
                </div>
            </div>

        </main>
    </div>
</div>

<div id="toast" class="toast hidden"><span>Action completed.</span></div>
<script src="assets/script.js"></script>
</body>
</html>